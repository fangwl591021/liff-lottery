<!DOCTYPE html>
<html lang="zh-Hant">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
Â  <title>LINE æŠ½ç</title>
Â  <style>
Â  Â  html, body {
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  background: #000;
Â  Â  Â  color: #fff;
Â  Â  Â  font-family: "Microsoft JhengHei", sans-serif;
Â  Â  Â  height: 100vh;
Â  Â  Â  overflow: hidden;
Â  Â  Â  display: flex; /* ä½¿ç”¨ Flexbox è®“å…§å®¹å‚ç›´ç½®ä¸­ */
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  }
Â  Â  .app {
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  /* justify-content: flex-start; /* åŸå§‹è¨­å®šï¼Œç¾åœ¨ç”± body è™•ç†ç½®ä¸­ */ */
Â  Â  Â  height: 100%;
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 20px;
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  max-width: 500px; /* é™åˆ¶æœ€å¤§å¯¬åº¦ï¼Œé¿å…åœ¨å¯¬è¢å¹•ä¸Šå¤ªåˆ†æ•£ */
Â  Â  Â  text-align: center; /* æ–‡å­—ç½®ä¸­ */
Â  Â  }
Â  Â  h1 {
Â  Â  Â  font-size: 2rem;
Â  Â  Â  margin: 30px 0 20px 0;
Â  Â  Â  text-align: center;
Â  Â  Â  color: gold;
Â  Â  }
Â  Â  button {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 50px;
Â  Â  Â  margin-top: 30px;
Â  Â  Â  font-size: 2.2rem;
Â  Â  Â  background: #28a745;
Â  Â  Â  color: #fff;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  cursor: pointer; /* è®“é¼ æ¨™è®Šæˆæ‰‹å‹ */
Â  Â  Â  transition: background-color 0.3s ease; /* æ·»åŠ éæ¸¡æ•ˆæœ */
Â  Â  }
Â  Â  button:hover:not(:disabled) {
Â  Â  Â  background-color: #218838; /* æ»‘é¼ ç§»ä¸Šæ™‚çš„é¡è‰² */
Â  Â  }
Â  Â  button:disabled {
Â  Â  Â  background-color: #555 !important;
Â  Â  Â  color: #ccc !important;
Â  Â  Â  cursor: not-allowed;
Â  Â  }
Â  Â  #form {
Â  Â  Â  display: none;
Â  Â  Â  width: 100%;
Â  Â  Â  margin-top: 30px;
Â  Â  }
Â  Â  #form h3 {
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  color: #fff;
Â  Â  }
Â  Â  input {
Â  Â  Â  width: calc(100% - 60px); /* æ¸›å» padding */
Â  Â  Â  padding: 30px;
Â  Â  Â  font-size: 1.5rem; /* èª¿æ•´å­—é«”å¤§å° */
Â  Â  Â  margin-top: 20px; /* èª¿æ•´ margin */
Â  Â  Â  border-radius: 8px;
Â  Â  Â  border: none;
Â  Â  Â  box-sizing: border-box; /* ç¢ºä¿ padding ä¸å¢åŠ å¯¬åº¦ */
Â  Â  }
Â  Â  #drawVideo {
Â  Â  Â  display: none;
Â  Â  Â  width: 100%;
Â  Â  Â  max-width: 400px; /* é™åˆ¶å½±ç‰‡æœ€å¤§å¯¬åº¦ */
Â  Â  Â  margin-top: 30px;
Â  Â  Â  border-radius: 12px;
Â  Â  }
Â  Â  #result {
Â  Â  Â  font-size: 2rem;
Â  Â  Â  margin-top: 30px;
Â  Â  Â  color: yellow;
Â  Â  Â  display: none;
Â  Â  Â  font-weight: bold;
Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="app">
Â  Â  <h1>ğŸ‰ LINE æŠ½ç ğŸ‰</h1>
Â  Â  <button id="drawBtn" disabled>è¼‰å…¥ä¸­...</button>

Â  Â  <video id="drawVideo" playsinline muted>
Â  Â  Â  Â  Â  Â  <source src="https://voom-obs.line-scdn.net/hlCRdDEcYL206cTxjDScoFBNJJEIQdnV_LAIXSjV7EgYpVB9hLCd0ChpvBhcjSzV8LDMXCyt7DQAXSHVzAw0bTyF7K18pSBQ7ADAMTDFBN1Q-XQ/mp4" type="video/mp4">
Â  Â  Â  æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒå½±ç‰‡æ¨™ç±¤ã€‚
Â  Â  </video>

Â  Â  <div id="result"></div>

Â  Â  <div id="form">
Â  Â  Â  <h3>æ­å–œä¸­çï¼è«‹å¡«å¯«ä»¥ä¸‹è³‡æ–™</h3>
Â  Â  Â  <input type="text" id="winnerName" placeholder="è¼¸å…¥æ‚¨çš„å§“å" />
Â  Â  Â  <input type="tel" id="winnerPhone" placeholder="è¼¸å…¥æ‚¨çš„é›»è©±" />
Â  Â  Â  <button id="submitBtn">é€å‡ºä¸­çè³‡æ–™</button>
Â  Â  </div>
Â  </div>

Â  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
Â  <script>
Â  Â  const liffId = "1656871455-vE1ZZLJ7"; // æ›¿æ›ç‚ºæ‚¨çš„ LIFF ID

Â  Â  let userId = "";
Â  Â  let displayName = "";

Â  Â  // ç²å– DOM å…ƒç´ 
Â  Â  const drawBtn = document.getElementById("drawBtn");
Â  Â  const drawVideo = document.getElementById("drawVideo");
Â  Â  const resultDiv = document.getElementById("result"); // æ›´åç‚º resultDiv é¿å…èˆ‡è®Šæ•¸è¡çª
Â  Â  const formDiv = document.getElementById("form"); // ç²å–è¡¨å–®å®¹å™¨
Â  Â  const winnerNameInput = document.getElementById("winnerName");
Â  Â  const winnerPhoneInput = document.getElementById("winnerPhone");
Â  Â  const submitBtn = document.getElementById("submitBtn");

Â  Â  // LIFF åˆå§‹åŒ–å‡½æ•¸
Â  Â  async function main() {
Â  Â  Â  try {
Â  Â  Â  Â  await liff.init({ liffId });
Â  Â  Â  Â  if (!liff.isLoggedIn()) {
Â  Â  Â  Â  Â  liff.login(); // å¦‚æœæœªç™»å…¥ï¼Œæœƒè‡ªå‹•è·³è½‰åˆ° LINE ç™»å…¥é é¢
Â  Â  Â  Â  Â  return; // ç™»å…¥å¾Œé é¢æœƒé‡æ–°è¼‰å…¥ï¼Œæ‰€ä»¥é€™è£¡ç›´æ¥è¿”å›
Â  Â  Â  Â  }
Â  Â  Â  Â  const profile = await liff.getProfile();
Â  Â  Â  Â  userId = profile.userId;
Â  Â  Â  Â  displayName = profile.displayName;
Â  Â  Â  Â  console.log("LIFF ç™»å…¥å®Œæˆï¼š", userId, displayName);

Â  Â  Â  Â  // ç™»å…¥æˆåŠŸå¾Œæª¢æŸ¥æŠ½çé…é¡
Â  Â  Â  Â  checkAndEnableDrawButton();

Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.error("LIFF åˆå§‹åŒ–å¤±æ•—æˆ–ç²å–è³‡æ–™éŒ¯èª¤", err);
Â  Â  Â  Â  drawBtn.textContent = "è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡è©¦";
Â  Â  Â  Â  drawBtn.disabled = true; // ç¢ºä¿æŒ‰éˆ•ä¸å¯ç”¨
Â  Â  Â  Â  alert("è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦ã€‚");
Â  Â  Â  }
Â  Â  }

Â  Â  // æª¢æŸ¥æŠ½çé…é¡ä¸¦å•Ÿç”¨æŒ‰éˆ•
Â  Â  function checkAndEnableDrawButton() {
Â  Â  Â  // èª¿ç”¨ Apps Script å¾Œç«¯æª¢æŸ¥æŠ½çæ¬¡æ•¸
Â  Â  Â  google.script.run.withSuccessHandler(function(count) {
Â  Â  Â  Â  console.log("ä»Šå¤©å·²æŠ½çæ¬¡æ•¸ï¼š", count);
Â  Â  Â  Â  if (count >= 3) {
Â  Â  Â  Â  Â  drawBtn.disabled = true;
Â  Â  Â  Â  Â  drawBtn.textContent = "ä»Šæ—¥æŠ½çæ¬¡æ•¸å·²ç”¨å®Œï¼";
Â  Â  Â  Â  Â  resultDiv.textContent = "ä»Šæ—¥æŠ½çæ¬¡æ•¸å·²ç”¨å®Œï¼Œè«‹æ˜å¤©å†ä¾†ï¼";
Â  Â  Â  Â  Â  resultDiv.style.display = "block";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  drawBtn.disabled = false;
Â  Â  Â  Â  Â  drawBtn.textContent = "é»æˆ‘æŠ½ç";
Â  Â  Â  Â  }
Â  Â  Â  }).withFailureHandler(function(error) {
Â  Â  Â  Â  console.error("æª¢æŸ¥æŠ½çé…é¡å¤±æ•—:", error);
Â  Â  Â  Â  drawBtn.disabled = true;
Â  Â  Â  Â  drawBtn.textContent = "æª¢æŸ¥é…é¡å¤±æ•—ï¼Œè«‹é‡è©¦";
Â  Â  Â  Â  alert("æª¢æŸ¥æŠ½çæ¬¡æ•¸å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
Â  Â  Â  }).checkDrawQuota(userId);
Â  Â  }

Â  Â  // æŠ½çæŒ‰éˆ•é»æ“Šäº‹ä»¶
Â  Â  drawBtn.addEventListener("click", () => {
Â  Â  Â  if (!userId) {
Â  Â  Â  Â  alert("LIFF è³‡è¨Šå°šæœªè¼‰å…¥ï¼Œè«‹ç¨å€™å†è©¦ã€‚");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // å†æ¬¡æª¢æŸ¥é…é¡ï¼Œé¿å…å¤šæ¬¡é»æ“Š
Â  Â  Â  google.script.run.withSuccessHandler(function(count) {
Â  Â  Â  Â  if (count >= 3) {
Â  Â  Â  Â  Â  alert("æ‚¨ä»Šå¤©å·²ç¶“æŠ½çä¸‰æ¬¡ï¼Œè«‹æ˜å¤©å†ä¾†ï¼");
Â  Â  Â  Â  Â  drawBtn.disabled = true;
Â  Â  Â  Â  Â  drawBtn.textContent = "ä»Šæ—¥æŠ½çæ¬¡æ•¸å·²ç”¨å®Œï¼";
Â  Â  Â  Â  Â  resultDiv.textContent = "ä»Šæ—¥æŠ½çæ¬¡æ•¸å·²ç”¨å®Œï¼Œè«‹æ˜å¤©å†ä¾†ï¼";
Â  Â  Â  Â  Â  resultDiv.style.display = "block";
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // ç¦ç”¨æŒ‰éˆ•ï¼Œéš±è—æŒ‰éˆ•ï¼Œé¡¯ç¤ºå½±ç‰‡
Â  Â  Â  Â  drawBtn.disabled = true;
Â  Â  Â  Â  drawBtn.style.display = "none";
Â  Â  Â  Â  resultDiv.style.display = "none";
Â  Â  Â  Â  formDiv.style.display = "none"; // éš±è—è¡¨å–®

Â  Â  Â  Â  drawVideo.style.display = "block";
Â  Â  Â  Â  drawVideo.currentTime = 0; // é‡ç½®å½±ç‰‡åˆ°é–‹é ­
Â  Â  Â  Â  drawVideo.play(); // æ’­æ”¾å½±ç‰‡

Â  Â  Â  Â  // å½±ç‰‡æ’­æ”¾çµæŸäº‹ä»¶ç›£è½å™¨
Â  Â  Â  Â  drawVideo.onended = () => {
Â  Â  Â  Â  Â  drawVideo.style.display = "none"; // éš±è—å½±ç‰‡
Â  Â  Â  Â  Â  drawVideo.onended = null; // ç§»é™¤äº‹ä»¶ç›£è½å™¨ï¼Œé¿å…é‡è¤‡è§¸ç™¼

Â  Â  Â  Â  Â  // è¨˜éŒ„é€™æ¬¡æŠ½çè¡Œç‚º (ç„¡è«–ä¸­çèˆ‡å¦)
Â  Â  Â  Â  Â  google.script.run.recordDraw(userId);

Â  Â  Â  Â  Â  // ä¸­çæ©Ÿç‡ 50%
Â  Â  Â  Â  Â  const win = Math.random() < 0.5;

Â  Â  Â  Â  Â  if (win) {
Â  Â  Â  Â  Â  Â  resultDiv.textContent = "ğŸŠ æ­å–œä¸­çï¼";
Â  Â  Â  Â  Â  Â  formDiv.style.display = "block"; // é¡¯ç¤ºä¸­çè¡¨å–®
Â  Â  Â  Â  Â  Â  winnerNameInput.value = displayName; // è‡ªå‹•å¡«å¯« LINE æš±ç¨±
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  resultDiv.textContent = "ğŸ˜­ éŠ˜è¬æƒ é¡§ï¼Œå†æ¥å†å²ï¼";
Â  Â  Â  Â  Â  Â  drawBtn.disabled = false; // æ²’ä¸­ççš„è©±è®“æŠ½çæŒ‰éˆ•å¯ä»¥å†æ¬¡é»æ“Š
Â  Â  Â  Â  Â  Â  drawBtn.style.display = "block"; // é¡¯ç¤ºæŠ½çæŒ‰éˆ•
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  resultDiv.style.display = "block"; // é¡¯ç¤ºçµæœè¨Šæ¯
Â  Â  Â  Â  };
Â  Â  Â  }).checkDrawQuota(userId); // å†æ¬¡æª¢æŸ¥é…é¡çš„ Apps Script å‘¼å«
Â  Â  });

Â  Â  // é€å‡ºä¸­çè³‡æ–™æŒ‰éˆ•é»æ“Šäº‹ä»¶
Â  Â  submitBtn.addEventListener("click", () => {
Â  Â  Â  const name = winnerNameInput.value;
Â  Â  Â  const phone = winnerPhoneInput.value;

Â  Â  Â  if (!name || !phone) {
Â  Â  Â  Â  alert("è«‹è¼¸å…¥å®Œæ•´è³‡æ–™");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // é–å®šé€å‡ºæŒ‰éˆ•
Â  Â  Â  submitBtn.disabled = true;
Â  Â  Â  submitBtn.textContent = "é€å‡ºä¸­...";

Â  Â  Â  // ä½¿ç”¨ google.script.run èª¿ç”¨ Apps Script å¾Œç«¯è¨˜éŒ„ä¸­çè€…
Â  Â  Â  google.script.run.withSuccessHandler(function() {
Â  Â  Â  Â  alert("âœ… å·²é€å‡ºä¸­çè³‡æ–™ï¼");
Â  Â  Â  Â  liff.closeWindow(); // é€å‡ºæˆåŠŸå¾Œé—œé–‰ LIFF è¦–çª—
Â  Â  Â  }).withFailureHandler(function(err) {
Â  Â  Â  Â  console.error("é€å‡ºä¸­çè³‡æ–™å¤±æ•—:", err);
Â  Â  Â  Â  alert("é€å‡ºå¤±æ•—ï¼š" + err.message);
Â  Â  Â  Â  submitBtn.disabled = false; // é€å‡ºå¤±æ•—å¾Œé‡æ–°å•Ÿç”¨æŒ‰éˆ•
Â  Â  Â  Â  submitBtn.textContent = "é‡æ–°é€å‡º";
Â  Â  Â  }).recordWinner({
Â  Â  Â  Â  userId,
Â  Â  Â  Â  displayName,
Â  Â  Â  Â  game: "æ‰‹æ©ŸæŠ½ç",
Â  Â  Â  Â  prize: "æ¸¬è©¦çé …", // æ‚¨å¯ä»¥æ ¹æ“šå¯¦éš›æƒ…æ³æ›´æ›çé …åç¨±
Â  Â  Â  Â  name,
Â  Â  Â  Â  phone
Â  Â  Â  });
Â  Â  });

Â  Â  // å•Ÿå‹• LIFF åˆå§‹åŒ–æµç¨‹
Â  Â  main();
Â  </script>
</body>
</html>
