<!DOCTYPE html>
<html lang="zh-Hant">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>è½‰è½‰å°ç‘ªè‰</title>
Â  <style>
Â  Â  body { background:#000; color:#fff; text-align:center; font-family:"Microsoft JhengHei" }
Â  Â  h1 { color:gold; margin:24px 0 12px }
Â  Â  #play, #submit { width:80%; max-width:320px; margin:12px auto; padding:14px 0;
Â  Â  Â  font-size:1.1em; border:none; border-radius:8px }
Â  Â  #play { background:#28a745; color:#fff }
Â  Â  #submit { background:#ffc107; color:#000; display:none }
Â  Â  #wrapSubmit{display:flex; justify-content:center}
Â  Â  video { width:100%; max-width:420px; border-radius:12px; display:none; margin-top:20px }
Â  Â  input { width:80%; max-width:320px; padding:10px; margin:6px 0; border-radius:6px; border:none; font-size:1em }
Â  Â  #msg { margin:18px 0 8px; font-size:1.4em; font-weight:bold }
Â  </style>
Â  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
Â  <h1>ğŸ° è½‰è½‰å°ç‘ªè‰</h1>
Â  <button id="play" disabled>è¼‰å…¥ä¸­â€¦</button>
Â  <video id="mv" playsinline>
Â  Â  <source src="https://voom-obs.line-scdn.net/hlCRdDEcYL206cTxjDScoFBNJJEIQdnV_LAIXSjV7EgYpVB9hLCd0ChpvBhcjSzV8LDMXCyt7DQAXSHVzAw0bTyF7K18pSBQ7ADAMTDFBN1Q-XQ/mp4">
Â  </video>
Â  <div id="msg"></div>
Â  <div id="form" style="display:none">
Â  Â  <input id="username" placeholder="å§“å" />
Â  Â  <input id="phone" placeholder="æ‰‹æ©Ÿ" />
Â  Â  <div id="wrapSubmit"><button id="submit">é€å‡º</button></div>
Â  </div>
Â  <audio id="winSound" preload="auto"
Â  Â  Â  Â  Â src="https://aiwe.cc/wp-content/uploads/2025/07/56ab24c15b72a457069c5ea42fcfc640.mp3"></audio>
Â  <audio id="loseSound" preload="auto"
Â  Â  Â  Â  Â src="https://aiwe.cc/wp-content/uploads/2025/07/b3a7a4e64bcd8aabe4cabe0e55b57af5.mp3"></audio>
<script>
const LIFF_ID = "1656871455-vE1ZZLJ7";
// **é‡è¦ï¼šè«‹å‹™å¿…å°‡æ­¤è™•çš„ API ç¶²å€æ›¿æ›ç‚ºæ‚¨æœ€æ–°éƒ¨ç½² Apps Script æ™‚ç²å–åˆ°çš„ã€Œç¶²è·¯æ‡‰ç”¨ç¨‹å¼ç¶²å€ã€**
const APIÂ  Â  Â = "https://script.google.com/macros/s/AKfycbzvl9QH1JKAu74r4n_0YbGcNOlWPbJLNRf1A9U6U3031jfK6-g2_2kktlmwpNSBg5lC_A/exec"; 
let uid="", uname="";
const btnPlay=document.getElementById("play"),
Â  Â  Â  mv=document.getElementById("mv"),
Â  Â  Â  msg=document.getElementById("msg"),
Â  Â  Â  form=document.getElementById("form"),
Â  Â  Â  inName=document.getElementById("username"),
Â  Â  Â  inPhone=document.getElementById("phone"),
Â  Â  Â  btnSend=document.getElementById("submit"),
Â  Â  Â  winSound=document.getElementById("winSound"),
Â  Â  Â  loseSound=document.getElementById("loseSound");

(async()=>{
Â  await liff.init({liffId:LIFF_ID});
Â  if(!liff.isLoggedIn()){ liff.login(); return; }
Â  const profile=await liff.getProfile();
Â  uid=profile.userId;
Â  uname=profile.displayName;
Â  btnPlay.disabled=false;
Â  btnPlay.textContent="é–‹å§‹éŠæˆ²";
})();

btnPlay.onclick=()=>{
Â  winSound.load(); loseSound.load();
Â  btnPlay.style.display="none";
Â  msg.textContent="";
Â  mv.style.display="block";
Â  mv.currentTime=0;
Â  mv.play();
Â  setTimeout(()=>mv.pause(),7000);
};

mv.onpause=async ()=>{
Â  mv.style.display="none";
Â  const win=Math.random()<0.5;
Â  msg.textContent=win?"ğŸŠ æ­å–œä¸­çï¼":"ğŸ˜­ å†æ¥å†å²ï¼";
Â  
Â  // --- ä¿®æ­£é» 1: ç§»é™¤ mode:"no-cors"ï¼Œä¸¦è™•ç†éŸ¿æ‡‰ ---
Â  const drawResponse = await fetch(API,{
Â  Â  method:"POST",
Â  Â  headers:{"Content-Type":"text/plain"}, // ä¿æŒ text/plainï¼Œå› ç‚º Apps Script doPost æ¥æ”¶çš„æ˜¯å­—ä¸²
Â  Â  body:JSON.stringify({act:"draw",userId:uid,displayName:uname,result:win?"WIN":"MISS"})
Â  }).then(res => res.json()).catch(e => {
    console.error("æŠ½çè¨˜éŒ„ç™¼é€å¤±æ•—:", e);
    // åœ¨é€™è£¡å¯ä»¥çµ¦ç”¨æˆ¶ä¸€å€‹æç¤ºï¼Œä¾‹å¦‚å½ˆçª—
    alert("æŠ½çè¨˜éŒ„ç™¼é€å¤±æ•—ï¼Œè«‹é‡è©¦ï¼"); // æ–°å¢ï¼šåœ¨å‰ç«¯çµ¦å‡ºæç¤º
    return { error: 'fetch_error', msg: 'æŠ½çè¨˜éŒ„ç™¼é€å¤±æ•—ï¼Œè«‹é‡è©¦ï¼' };
});

// æ‚¨å¯ä»¥æ ¹æ“š drawResponse çš„å…§å®¹ä¾†åˆ¤æ–·æ˜¯å¦æˆåŠŸ
// ä¾‹å¦‚ï¼šif (drawResponse.error) { alert(drawResponse.msg); }
// ç›®å‰é€™æ®µæš«ä¸è™•ç†æŠ½çå›æ‡‰ï¼Œå› ç‚ºä¸»è¦é‚è¼¯åœ¨ winner æ‰æœƒå›å‚³çå“åç¨±

Â  if(win){
Â  Â  try{ await winSound.play(); }catch(_){}
Â  Â  form.style.display="block";
Â  Â  inName.value=uname;
Â  Â  btnSend.style.display="block";
Â  } else {
Â  Â  try{ await loseSound.play(); }catch(_){}
Â  Â  // å¦‚æœæ²’æœ‰ä¸­çï¼Œè‡ªå‹•é—œé–‰ LIFF è¦–çª—
Â  Â  // é€™è£¡å¯ä»¥æ ¹æ“šéœ€æ±‚åŠ å…¥å»¶é²æˆ–æŒ‰éˆ•
    setTimeout(() => {
        liff.closeWindow();
    }, 2000); // 2ç§’å¾Œè‡ªå‹•é—œé–‰
Â  }
};

btnSend.onclick=async ()=>{ // é€™è£¡ä¹ŸåŠ ä¸Š async
Â  if(!inName.value.trim() || !inPhone.value.trim()){
Â  Â  alert("è«‹å¡«å§“åèˆ‡æ‰‹æ©Ÿ");
Â  Â  return;
Â  }
Â  btnSend.disabled=true;
Â  btnSend.innerText="é€å‡ºä¸­â€¦";
Â  btnSend.style.background="#555";

Â  // --- ä¿®æ­£é» 2: ç§»é™¤ mode:"no-cors"ï¼Œä¸¦è®“å¾Œç«¯æ±ºå®šçå“åç¨± ---
Â  // --- ä¿®æ­£é» 3: è™•ç†å¾Œç«¯è¿”å›çš„ JSON éŸ¿æ‡‰ ---
Â  const winnerResponse = await fetch(API,{
Â  Â  method:"POST",
Â  Â  headers:{"Content-Type":"text/plain"},
Â  Â  body:JSON.stringify({
Â  Â  Â  act:"winner",
Â  Â  Â  userId:uid,
Â  Â  Â  displayName:uname,
Â  Â  Â  // prize:"é è¨­çé …", // <-- ç§»é™¤é€™è¡Œï¼Œè®“å¾Œç«¯æ±ºå®šï¼
Â  Â  Â  name:inName.value.trim(),
Â  Â  Â  phone:inPhone.value.trim()
Â  Â  })
Â  }).then(res => res.json()) // <-- è§£æ JSON éŸ¿æ‡‰
Â  .then(data => {
Â  Â  if(data.ok){ // å¾Œç«¯è¿”å› {ok:true} è¡¨ç¤ºæˆåŠŸ
Â  Â  Â  msg.textContent="âœ… å·²é€å‡ºï¼æ„Ÿè¬å¡«å¯«";
Â  Â  Â  btnSend.disabled=false;
Â  Â  Â  btnSend.style.background="#fff";
Â  Â  Â  btnSend.style.color="#000";
Â  Â  Â  btnSend.innerText="é»å³ä¸Šè§’ X è¿”å›";
Â  Â  Â  btnSend.onclick=()=>liff.closeWindow();
Â  Â  } else { // å¾Œç«¯è¿”å› {error: ...}
Â  Â  Â  alert("é€å‡ºå¤±æ•—ï¼š" + (data.msg || data.error || "æœªçŸ¥éŒ¯èª¤"));
Â  Â  Â  btnSend.disabled=false;
Â  Â  Â  btnSend.innerText="é‡æ–°é€å‡º";
Â  Â  Â  btnSend.style.background="#ffc107";
Â  Â  }
Â  }).catch(e => { // <-- ç¾åœ¨é€™å€‹ catch å€å¡Šæœƒè¢«è§¸ç™¼äº†ï¼
Â  Â  alert("é€å‡ºå¤±æ•—ï¼šç¶²è·¯å•é¡Œæˆ–ä¼ºæœå™¨éŒ¯èª¤ã€‚\n" + e.message);
Â  Â  console.error("Winner record fetch error:", e);
Â  Â  btnSend.disabled=false;
Â  Â  btnSend.innerText="é‡æ–°é€å‡º";
Â  Â  btnSend.style.background="#ffc107";
Â  });
};
</script>
</body>
</html>
